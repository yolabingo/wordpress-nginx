## generated by ./build-wordpress.conf.sh ##
# vim: syntax=nginx

server_tokens off;
fastcgi_hide_header X-Powered-By;
proxy_hide_header X-Powered-By;
autoindex off;
index index.php;

# recommended security headers
# add_header X-Frame-Options SAMEORIGIN;
# add_header Strict-Transport-Security "max-age=31536000";
# add_header X-Content-Type-Options nosniff;
# add_header X-XSS-Protection "1; mode=block";

location / {
        deny all;
}
# append a slash if it looks like a slug but is missing the trailing slash
location ~ (/[\w-%]+)+$ {
        return 301 https://$host$request_uri/;
}

### BEGIN Pass directly to Wordpress ###
# add "include snippets/wordpress-nginx/admin-whitelist-ips.conf;"
# to site config to restrict the entire site, otherwise Wordpress pages are public
location ~ ^$ {
        try_files /dev/null /index.php?$args;
}
# Wordpress Permalinks have a trailing /
location ~ /$ {
        try_files /dev/null /index.php?$args;
}
location = /index.php {
	include snippets/wordpress-nginx/php.conf;
}
### END Pass directly to Wordpress ###

## default disable theme editor, cron, links, xmlrpc, trackback
location ~ /wp-admin/network/theme-editor\.php$ {
	return 301 /wp-admin/;
}
location ~ /wp-links-opml\.php$ {
	return 301 /wp-admin/;
}
# recommended to "define('DISABLE_WP_CRON', 'true');" in wp-config.php and run hourly via cron/cli
# "0 * * * *  php  /path/to/wp-cron.php"
location ~ /wp-cron\.php$ {
        deny all;
}
location ~ /xmlrpc\.php$ {
        deny all;
}
location ~ /trackback\.php$ {
        deny all;
}

### you may want to customize a few common features - login, comments, signup, links
# remove "include snippets/wordpress-nginx/admin-whitelist-ips.conf;" from these
# if you want to allow public login, signup, or comments
# woo commerce requires public login/signup
#
#
location ~ /wp-login\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-signup\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-comments-post\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}

# allow static content
location ~* /wp-(admin|content|includes)/.*\.(ai|bmp|css|doc|eot|f4l|flv|gif|gz|jpe?g|js|json|mov|mp3|mp4|mpg|pages|pdf|png|ppt|psd|qt|svg|ttc|ttf|txt|wav|wmv|woff|woff2|xls|zip)$ {
	include snippets/wordpress-nginx/static.conf;
}
location ~* /(autodiscover\.xml|favicon\.ico|robots.txt)$ {
	log_not_found off;
	access_log    off;
	include snippets/wordpress-nginx/static.conf;
}
location ~ /(\.|readme\.html|license\.txt|wp-config\.php\.tmpl)$ {
	deny all;
}
# allow Wordpress to generate sitemaps
location ~ /sitemap.*\.xml(\.gz)?$ {
        try_files $uri /index.php?$args;
}
# allow Let's Encrypt
# certbot certonly --webroot -d example.com -w /var/www --deploy-hook "/usr/bin/systemctl reload nginx.service"
location ^~ /.well-known/acme-challenge/ {
        allow       all;
    	root        /var/www;
	include snippets/wordpress-nginx/static.conf;
}

### wordpress urls below  ###

location ~ /wp-activate\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-comments-post\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-login\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-mail\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-signup\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/about\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/admin-ajax\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/admin-functions\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/admin-post\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/admin\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/async-upload\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/comment\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/credits\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/customize\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/edit-comments\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/edit-tags\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/edit\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/erase-personal-data\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/export-personal-data\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/export\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/freedoms\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/import\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/(index\.php)$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/link-add\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/link-manager\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/link\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/media-new\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/media-upload\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/media\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/ms-admin\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/ms-delete-site\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/ms-edit\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/ms-options\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/ms-sites\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/ms-themes\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/ms-upgrade-network\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/ms-users\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/my-sites\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/nav-menus\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/network\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/options-discussion\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/options-general\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/options-media\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/options-permalink\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/options-privacy\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/options-reading\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/options-writing\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/options\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/plugin-editor\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/plugin-install\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/plugins\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/post-new\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/post\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/press-this\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/privacy-policy-guide\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/privacy\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/revision\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/site-health-info\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/site-health\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/term\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/theme-editor\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/theme-install\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/themes\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/tools\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/update-core\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/update\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/upload\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/user-edit\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/user-new\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/users\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/widgets\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/network/about\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/network/admin\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/network/credits\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/network/edit\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/network/freedoms\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/network/(index\.php)$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/network/plugin-editor\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/network/plugin-install\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/network/plugins\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/network/privacy\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/network/profile\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/network/settings\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/network/setup\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/network/site-info\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/network/site-new\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/network/site-settings\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/network/site-themes\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/network/site-users\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/network/sites\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/network/theme-editor\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/network/theme-install\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/network/themes\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/network/update-core\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/network/update\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/network/upgrade\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/network/user-edit\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/network/user-new\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/network/users\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/user/about\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/user/admin\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/user/credits\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/user/freedoms\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/user/(index\.php)$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/user/privacy\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/user/profile\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
location ~ /wp-admin/user/user-edit\.php$ {
	include snippets/wordpress-nginx/admin-whitelist-ips.conf;
	include snippets/wordpress-nginx/php.conf;
}
